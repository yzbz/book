<!DOCTYPE html>
<html>
<head>
      <title>swoole chat room</title>
      <meta charset="UTF-8">

</head>
<body>
    <div style="width:600px;margin:0 auto;border:1px solid #ccc;">
        <div id="content" style="overflow-y:auto;height:300px;"></div>
        <input type="hidden" id="room_id">
        <hr/>
        <div style="height:40px">
            <input type="text" id="message" style="margin-left:10px;height:25px;width:450px;">
            <button onclick="sendMessage()" style="height:28px;width:75px;">发送</button>
        </div>
    </div>
    <script src="https://ss1.bdstatic.com/5eN1bjq8AAUYm2zgoY3K/r/www/cache/static/protocol/https/jquery/jquery-1.10.2.min_65682a2.js"></script>
    <script type="text/javascript">
        if(window.WebSocket){
			var switchStatus = 0;
            var webSocket = new WebSocket("ws://www.lbelieve.cn:9502");
            webSocket.onopen = function (event) {
                //webSocket.send("Hello,WebSocket!");
				switchStatus = 1;
            };
            webSocket.onmessage = function (event) {
                var content = document.getElementById('content');
                var params = JSON.parse(event.data);
                if (params.hasOwnProperty('room_id')) {
                    $("#room_id").val(params.room_id)
                }
				console.log(params.msg)
                content.innerHTML = content.innerHTML.concat('<p style="margin-left:20px;height:20px;line-height:20px;">'+params.msg+'</p>');
            }
			webSocket.onclose = function(event) {
				//console.log(event)
				switchStatus = 0;
			}

            var sendMessage = function(){
				if (switchStatus == 1) {
					var data = document.getElementById('message').value;
					var room_id = document.getElementById('room_id').value;
					var obj = {};
					obj.msg = data;
					obj.room_id = room_id;
					webSocket.send(JSON.stringify(obj));
					document.getElementById('message').value = '';
				} else {
					alert('websocket closed');
				}
            }
        }else{
            console.log("您的浏览器不支持WebSocket");
        }
		

    </script>
</body>
</html>
